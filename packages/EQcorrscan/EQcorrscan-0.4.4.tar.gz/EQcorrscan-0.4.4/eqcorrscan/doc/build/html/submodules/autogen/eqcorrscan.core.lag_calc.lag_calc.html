<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17: http://docutils.sourceforge.net/" />

    <title>eqcorrscan.core.lag_calc.lag_calc &#8212; EQcorrscan 0.4.3 documentation</title>
    <link rel="stylesheet" href="../../_static/bootstrap-sphinx.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <script id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/language_data.js"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true, "ignoreClass": "document", "processClass": "math|output_area"}})</script>
    <link rel="shortcut icon" href="../../_static/EQcorrscan_logo.ico"/>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">
<script type="text/javascript" src="../../_static/js/jquery-1.12.4.min.js "></script>
<script type="text/javascript" src="../../_static/js/jquery-fix.js "></script>
<script type="text/javascript" src="../../_static/bootstrap-3.4.1/js/bootstrap.min.js "></script>
<script type="text/javascript" src="../../_static/bootstrap-sphinx.js "></script>

  </head><body>

  <div id="navbar" class="navbar navbar-default navbar-fixed-top">
    <div class="container">
      <div class="navbar-header">
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="../../index.html"><span><img src="../../_static/EQcorrscan_logo.jpg"></span>
          EQcorrscan</a>
        <span class="navbar-text navbar-version pull-left"><b>0.4</b></span>
      </div>

        <div class="collapse navbar-collapse nav-collapse">
          <ul class="nav navbar-nav">
            
            
              <li class="dropdown globaltoc-container">
  <a role="button"
     id="dLabelGlobalToc"
     data-toggle="dropdown"
     data-target="#"
     href="../../index.html">Site <b class="caret"></b></a>
  <ul class="dropdown-menu globaltoc"
      role="menu"
      aria-labelledby="dLabelGlobalToc"><ul>
<li class="toctree-l1"><a class="reference internal" href="../../intro.html">1. Introduction to the EQcorrscan package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../installation.html">2. EQcorrscan installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../updates.html">3. What’s new</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tutorial.html">4. EQcorrscan tutorials</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api.html">5. EQcorrscan API</a></li>
</ul>
</ul>
</li>
              
                <li class="dropdown">
  <a role="button"
     id="dLabelLocalToc"
     data-toggle="dropdown"
     data-target="#"
     href="#">Page <b class="caret"></b></a>
  <ul class="dropdown-menu localtoc"
      role="menu"
      aria-labelledby="dLabelLocalToc"><ul>
<li><a class="reference internal" href="#">eqcorrscan.core.lag_calc.lag_calc</a></li>
</ul>
</ul>
</li>
              
            
            
              
                
              
            
            
            
            
              <li class="hidden-sm">
<div id="sourcelink">
  <a href="../../_sources/submodules/autogen/eqcorrscan.core.lag_calc.lag_calc.rst.txt"
     rel="nofollow">Source</a>
</div></li>
            
          </ul>

          
            
<form class="navbar-form navbar-right" action="../../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
          
        </div>
    </div>
  </div>

<div class="container">
  <div class="row">
    <div class="body col-md-12 content" role="main">
      
  <section id="eqcorrscan-core-lag-calc-lag-calc">
<h1>eqcorrscan.core.lag_calc.lag_calc<a class="headerlink" href="#eqcorrscan-core-lag-calc-lag-calc" title="Permalink to this headline">¶</a></h1>
<dl class="py function">
<dt id="eqcorrscan.core.lag_calc.lag_calc">
<code class="sig-prename descclassname">eqcorrscan.core.lag_calc.</code><code class="sig-name descname">lag_calc</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">detections</span></em>, <em class="sig-param"><span class="n">detect_data</span></em>, <em class="sig-param"><span class="n">template_names</span></em>, <em class="sig-param"><span class="n">templates</span></em>, <em class="sig-param"><span class="n">shift_len</span><span class="o">=</span><span class="default_value">0.2</span></em>, <em class="sig-param"><span class="n">min_cc</span><span class="o">=</span><span class="default_value">0.4</span></em>, <em class="sig-param"><span class="n">min_cc_from_mean_cc_factor</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">horizontal_chans</span><span class="o">=</span><span class="default_value">['E', 'N', '1', '2']</span></em>, <em class="sig-param"><span class="n">vertical_chans</span><span class="o">=</span><span class="default_value">['Z']</span></em>, <em class="sig-param"><span class="n">cores</span><span class="o">=</span><span class="default_value">1</span></em>, <em class="sig-param"><span class="n">interpolate</span><span class="o">=</span><span class="default_value">False</span></em>, <em class="sig-param"><span class="n">plot</span><span class="o">=</span><span class="default_value">False</span></em>, <em class="sig-param"><span class="n">plotdir</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">export_cc</span><span class="o">=</span><span class="default_value">False</span></em>, <em class="sig-param"><span class="n">cc_dir</span><span class="o">=</span><span class="default_value">None</span></em><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/eqcorrscan/core/lag_calc.html#lag_calc"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#eqcorrscan.core.lag_calc.lag_calc" title="Permalink to this definition">¶</a></dt>
<dd><p>Cross-correlation derived picking of seismic events.</p>
<p>Overseer function to take a list of detection objects, cut the data for
them to lengths of the same length of the template + shift_len on
either side. This will output a <a class="reference external" href="https://docs.obspy.org/packages/autogen/obspy.core.event.Catalog.html#obspy.core.event.Catalog" title="(in ObsPy Documentation (1.2.0) v1.2)"><code class="xref py py-class docutils literal notranslate"><span class="pre">obspy.core.event.Catalog</span></code></a> of
picked events. Pick times are based on the lag-times found at the maximum
correlation, providing that correlation is above the min_cc.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>detections</strong> (<em>list</em>) – List of <code class="xref py py-class docutils literal notranslate"><span class="pre">eqcorrscan.core.match_filter.Detection</span></code> objects.</p></li>
<li><p><strong>detect_data</strong> (<a class="reference external" href="https://docs.obspy.org/packages/autogen/obspy.core.stream.Stream.html#obspy.core.stream.Stream" title="(in ObsPy Documentation (1.2.0) v1.2)"><em>obspy.core.stream.Stream</em></a>) – All the data needed to cut from - can be a gappy Stream.</p></li>
<li><p><strong>template_names</strong> (<em>list</em>) – List of the template names, used to help identify families of events.
Must be in the same order as templates.</p></li>
<li><p><strong>templates</strong> (<em>list</em>) – <dl class="simple">
<dt>List of the templates, templates must be a list of</dt><dd><p><a class="reference external" href="https://docs.obspy.org/packages/autogen/obspy.core.stream.Stream.html#obspy.core.stream.Stream" title="(in ObsPy Documentation (1.2.0) v1.2)"><code class="xref py py-class docutils literal notranslate"><span class="pre">obspy.core.stream.Stream</span></code></a> objects.</p>
</dd>
</dl>
</p></li>
<li><p><strong>shift_len</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#float" title="(in Python v2.7)"><em>float</em></a>) – Shift length allowed for the pick in seconds, will be plus/minus this
amount - default=0.2</p></li>
<li><p><strong>min_cc</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#float" title="(in Python v2.7)"><em>float</em></a>) – Minimum cross-correlation value to be considered a pick, default=0.4.</p></li>
<li><p><strong>min_cc_from_mean_cc_factor</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#float" title="(in Python v2.7)"><em>float</em></a>) – If set to a value other than None, then the minimum cross-correlation
value for a trace is set individually for each detection based on:
min(detect_val / n_chans * min_cc_from_mean_cc_factor, min_cc).</p></li>
<li><p><strong>horizontal_chans</strong> (<em>list</em>) – List of channel endings for horizontal-channels, on which S-picks will
be made.</p></li>
<li><p><strong>vertical_chans</strong> (<em>list</em>) – List of channel endings for vertical-channels, on which P-picks will
be made.</p></li>
<li><p><strong>cores</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#int" title="(in Python v2.7)"><em>int</em></a>) – Number of cores to use in parallel processing, defaults to one.</p></li>
<li><p><strong>interpolate</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#bool" title="(in Python v2.7)"><em>bool</em></a>) – Interpolate the correlation function to achieve sub-sample precision.</p></li>
<li><p><strong>plot</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#bool" title="(in Python v2.7)"><em>bool</em></a>) – To generate a plot for every detection or not, defaults to False</p></li>
<li><p><strong>plotdir</strong> – Path to plotting folder, plots will be output here.</p></li>
<li><p><strong>export_cc</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#bool" title="(in Python v2.7)"><em>bool</em></a>) – To generate a binary file in NumPy for every detection or not,
defaults to False</p></li>
<li><p><strong>cc_dir</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – Path to saving folder, NumPy files will be output here.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>Catalog of events with picks.  No origin information is included.
These events can then be written out via
<code class="xref py py-func docutils literal notranslate"><span class="pre">obspy.core.event.Catalog.write()</span></code>, or to Nordic Sfiles using
<code class="xref py py-func docutils literal notranslate"><span class="pre">eqcorrscan.utils.sfile_util.eventtosfile()</span></code> and located
externally.</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p><a class="reference external" href="https://docs.obspy.org/packages/autogen/obspy.core.event.Catalog.html#obspy.core.event.Catalog" title="(in ObsPy Documentation (1.2.0) v1.2)">obspy.core.event.Catalog</a></p>
</dd>
</dl>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Picks output in catalog are generated relative to the template
start-time.  For example, if you generated your template with a
pre_pick time of 0.2 seconds, you should expect picks generated by
lag_calc to occur 0.2 seconds before the true phase-pick.  This
is because we do not currently store template meta-data alongside the
templates.</p>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Because of the above note, origin times will be consistently
shifted by the static pre_pick applied to the templates.</p>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>This routine requires only one template per channel (e.g. you should
not use templates with a P and S template on a single channel).  If
this does occur an error will be raised.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>S-picks will be made on horizontal channels, and P picks made on
vertical channels - the default is that horizontal channels end in
one of: ‘E’, ‘N’, ‘1’ or ‘2’, and that vertical channels end in ‘Z’.
The options vertical_chans and horizontal_chans can be changed to suit
your dataset.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Individual channel cross-correlations are stored as a
<code class="xref py py-class docutils literal notranslate"><span class="pre">obspy.core.event.Comment</span></code> for each pick, and the summed
cross-correlation value resulting from these is stored as a
<code class="xref py py-class docutils literal notranslate"><span class="pre">obspy.core.event.Comment</span></code> in the main
<code class="xref py py-class docutils literal notranslate"><span class="pre">obspy.core.event.Event</span></code> object.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The order of events is preserved (e.g. detections[n] == output[n]),
providing picks have been made for that event.  If no picks have
been made for an event, it will not be included in the output.
However, as each detection has an ID associated with it, these can
be mapped to the output resource_id for each Event in the output
Catalog. e.g.</p>
<blockquote>
<div><p>detections[n].id == output[m].resource_id</p>
</div></blockquote>
<p>if the output[m] is for the same event as detections[n].</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The correlation data that are saved to the binary files can be useful
to select an appropriate threshold for your data.</p>
</div>
</dd></dl>

</section>


    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
    <p class="pull-right">
      <a href="#">Back to top</a>
      
    </p>
    <p>
        &copy; Copyright 2015-2021: EQcorrscan developers.<br/>
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 3.2.1.<br/>
    </p>
  </div>
</footer>
  </body>
</html>