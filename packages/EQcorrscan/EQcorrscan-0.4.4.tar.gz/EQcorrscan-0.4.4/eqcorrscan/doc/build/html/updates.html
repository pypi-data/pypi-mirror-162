<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17: http://docutils.sourceforge.net/" />

    <title>3. What’s new &#8212; EQcorrscan 0.4.3 documentation</title>
    <link rel="stylesheet" href="_static/bootstrap-sphinx.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <script id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/language_data.js"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true, "ignoreClass": "document", "processClass": "math|output_area"}})</script>
    <link rel="shortcut icon" href="_static/EQcorrscan_logo.ico"/>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="4. EQcorrscan tutorials" href="tutorial.html" />
    <link rel="prev" title="2. EQcorrscan installation" href="installation.html" />
<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">
<script type="text/javascript" src="_static/js/jquery-1.12.4.min.js "></script>
<script type="text/javascript" src="_static/js/jquery-fix.js "></script>
<script type="text/javascript" src="_static/bootstrap-3.4.1/js/bootstrap.min.js "></script>
<script type="text/javascript" src="_static/bootstrap-sphinx.js "></script>

  </head><body>

  <div id="navbar" class="navbar navbar-default navbar-fixed-top">
    <div class="container">
      <div class="navbar-header">
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="index.html"><span><img src="_static/EQcorrscan_logo.jpg"></span>
          EQcorrscan</a>
        <span class="navbar-text navbar-version pull-left"><b>0.4</b></span>
      </div>

        <div class="collapse navbar-collapse nav-collapse">
          <ul class="nav navbar-nav">
            
            
              <li class="dropdown globaltoc-container">
  <a role="button"
     id="dLabelGlobalToc"
     data-toggle="dropdown"
     data-target="#"
     href="index.html">Site <b class="caret"></b></a>
  <ul class="dropdown-menu globaltoc"
      role="menu"
      aria-labelledby="dLabelGlobalToc"><ul class="current">
<li class="toctree-l1"><a class="reference internal" href="intro.html">1. Introduction to the EQcorrscan package</a></li>
<li class="toctree-l1"><a class="reference internal" href="installation.html">2. EQcorrscan installation</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">3. What’s new</a></li>
<li class="toctree-l1"><a class="reference internal" href="tutorial.html">4. EQcorrscan tutorials</a></li>
<li class="toctree-l1"><a class="reference internal" href="api.html">5. EQcorrscan API</a></li>
</ul>
</ul>
</li>
              
                <li class="dropdown">
  <a role="button"
     id="dLabelLocalToc"
     data-toggle="dropdown"
     data-target="#"
     href="#">Page <b class="caret"></b></a>
  <ul class="dropdown-menu localtoc"
      role="menu"
      aria-labelledby="dLabelLocalToc"><ul>
<li><a class="reference internal" href="#">3. What’s new</a><ul>
<li><a class="reference internal" href="#version-0-4-2">3.1. Version 0.4.2</a></li>
<li><a class="reference internal" href="#version-0-4-1">3.2. Version 0.4.1</a></li>
<li><a class="reference internal" href="#version-0-4-0">3.3. Version 0.4.0</a></li>
<li><a class="reference internal" href="#older-versions">3.4. Older Versions</a><ul>
<li><a class="reference internal" href="#version-0-3-3">3.4.1. Version 0.3.3</a></li>
<li><a class="reference internal" href="#version-0-3-2">3.4.2. Version 0.3.2</a></li>
<li><a class="reference internal" href="#version-0-3-1">3.4.3. Version 0.3.1</a></li>
<li><a class="reference internal" href="#version-0-3-0">3.4.4. Version 0.3.0</a></li>
<li><a class="reference internal" href="#version-0-2-7">3.4.5. Version 0.2.7</a></li>
<li><a class="reference internal" href="#version-0-2-6">3.4.6. Version 0.2.6</a></li>
<li><a class="reference internal" href="#version-0-2-5">3.4.7. Version 0.2.5</a></li>
<li><a class="reference internal" href="#version-0-2-4">3.4.8. Version 0.2.4</a></li>
<li><a class="reference internal" href="#version-0-2-0-0-2-3">3.4.9. Version 0.2.0-0.2.3</a></li>
<li><a class="reference internal" href="#version-0-1-6">3.4.10. Version 0.1.6</a></li>
<li><a class="reference internal" href="#version-0-1-5">3.4.11. Version 0.1.5</a></li>
<li><a class="reference internal" href="#version-0-1-4">3.4.12. Version 0.1.4</a></li>
<li><a class="reference internal" href="#version-0-1-3">3.4.13. Version 0.1.3</a></li>
<li><a class="reference internal" href="#version-0-1-2">3.4.14. Version 0.1.2</a></li>
<li><a class="reference internal" href="#version-0-1-1">3.4.15. Version 0.1.1</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</ul>
</li>
              
            
            
              
                
  <li>
    <a href="installation.html" title="Previous Chapter: 2. EQcorrscan installation"><span class="glyphicon glyphicon-chevron-left visible-sm"></span><span class="hidden-sm hidden-tablet">&laquo; 2. EQcorrscan...</span>
    </a>
  </li>
  <li>
    <a href="tutorial.html" title="Next Chapter: 4. EQcorrscan tutorials"><span class="glyphicon glyphicon-chevron-right visible-sm"></span><span class="hidden-sm hidden-tablet">4. EQcorrscan... &raquo;</span>
    </a>
  </li>
              
            
            
            
            
              <li class="hidden-sm">
<div id="sourcelink">
  <a href="_sources/updates.rst.txt"
     rel="nofollow">Source</a>
</div></li>
            
          </ul>

          
            
<form class="navbar-form navbar-right" action="search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
          
        </div>
    </div>
  </div>

<div class="container">
  <div class="row">
    <div class="body col-md-12 content" role="main">
      
  <section id="what-s-new">
<h1><span class="section-number">3. </span>What’s new<a class="headerlink" href="#what-s-new" title="Permalink to this headline">¶</a></h1>
<section id="version-0-4-2">
<h2><span class="section-number">3.1. </span>Version 0.4.2<a class="headerlink" href="#version-0-4-2" title="Permalink to this headline">¶</a></h2>
<ul>
<li><p>Add seed-ids to the _spike_test’s message.</p></li>
<li><p>utils.correlation
- Cross-correlation normalisation errors no-longer raise an error
- When “out-of-range” correlations occur a warning is given by the C-function</p>
<blockquote>
<div><p>with details of what channel, what template and where in the data vector
the issue occurred for the user to check their data.</p>
</div></blockquote>
<ul class="simple">
<li><p>Out-of-range correlations are set to 0.0</p></li>
<li><p>After extensive testing these errors have always been related to data issues
within regions where correlations should not be computed (spikes, step
artifacts due to incorrectly padding data gaps).</p></li>
<li><p>USERS SHOULD BE CAREFUL TO CHECK THEIR DATA IF THEY SEE THESE WARNINGS</p></li>
</ul>
</li>
<li><p>utils.mag_calc.amp_pick_event
- Added option to output IASPEI standard amplitudes, with static amplification</p>
<blockquote>
<div><p>of 1 (rather than 2080 as per Wood Anderson specs).</p>
</div></blockquote>
<ul class="simple">
<li><p>Added <cite>filter_id</cite> and <cite>method_id</cite> to amplitudes to make these methods more
traceable.</p></li>
</ul>
</li>
<li><p>core.match_filter
- Bug-fix - cope with data that are too short with <cite>ignore_bad_data=True</cite>.</p>
<blockquote>
<div><p>This flag is generally not advised, but when used, may attempt to trim all
data to zero length.  The expected behaviour is to remove bad data and run
with the remaining data.</p>
</div></blockquote>
<ul>
<li><p>Party:
- decluster now accepts a hypocentral_separation argument. This allows</p>
<blockquote>
<div><p>the inclusion of detections that occur close in time, but not in space.
This is underwritten by a new findpeaks.decluster_dist_time function
based on a new C-function.</p>
</div></blockquote>
</li>
<li><p>Tribe:
- Add monkey-patching for clients that do not have a <cite>get_waveforms_bulk</cite></p>
<blockquote>
<div><p>method for use in <cite>.client_detect</cite>. See issue #394.</p>
</div></blockquote>
</li>
</ul>
</li>
<li><p>utils.pre_processing
- Only templates that need to be reshaped are reshaped now - this can be a lot</p>
<blockquote>
<div><p>faster.</p>
</div></blockquote>
</li>
</ul>
</section>
<section id="version-0-4-1">
<h2><span class="section-number">3.2. </span>Version 0.4.1<a class="headerlink" href="#version-0-4-1" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>core.match_filter
- BUG-FIX: Empty families are no longer run through lag-calc when using Party.lag_calc().  Previously this resulted in a “No matching data” error, see #341.</p></li>
<li><p>core.template_gen
- BUG-FIX: Fix bug where events were incorrectly associated with templates in <cite>Tribe().construct()</cite> if the given catalog contained events outside of the time-range of the stream. See issue #381 and PR #382.</p></li>
<li><p>utils.catalog_to_dd
- Added ability to turn off parallel processing (this is turned off by default now) for <cite>write_correlations</cite> - parallel processing for moderate to large datasets was copying far too much data and using lots of memory. This is a short-term fix - ideally we will move filtering and resampling to C functions with shared-memory parallelism and GIL releasing. See PR #374.
- Moved parallelism for <cite>_compute_dt_correlations</cite> to the C functions to reduce memory overhead. Using a generator to construct sub-catalogs rather than making a list of lists in memory. See issue #361.</p></li>
<li><p>utils.mag_calc:
- <cite>amp_pick_event</cite> now works on a copy of the data by default
- <cite>amp_pick_event</cite> uses the appropriate digital filter gain to correct the applied filter. See issue #376.
- <cite>amp_pick_event</cite> rewritten for simplicity.
- <cite>amp_pick_event</cite> now has simple synthetic tests for accuracy.
- <cite>_sim_wa</cite> uses the full response information to correct to velocity this includes FIR filters (previously not used), and ensures that the wood-anderson poles (with a single zero) are correctly applied to velocity waveforms.
- <cite>calc_max_curv</cite> is now computed using the non-cumulative distribution.</p></li>
<li><p>Some problem solved in _match_filter_plot. Now it shows all new detections.</p></li>
<li><p>Add plotdir to eqcorrscan.core.lag_calc.lag_calc function to save the images.</p></li>
</ul>
</section>
<section id="version-0-4-0">
<h2><span class="section-number">3.3. </span>Version 0.4.0<a class="headerlink" href="#version-0-4-0" title="Permalink to this headline">¶</a></h2>
<ul>
<li><p>Change resampling to use pyFFTW backend for FFT’s.  This is an attempt to
alleviate issue related to large-prime length transforms.  This requires an
additional dependency, but EQcorrscan already depends on FFTW itself (#316).</p></li>
<li><p>Refactor of catalog_to_dd functions (#322):
- Speed-ups, using new correlation functions and better resource management
- Removed enforcement of seisan, arguments are now standard obspy objects.</p></li>
<li><p>Add plotdir to lag-calc, template construction and matched-filter detection
methods and functions (#330, #325).</p></li>
<li><p>Wholesale re-write of lag-calc function and methods. External interface is
similar, but some arguments have been depreciated as they were unnecessary (#321).
- This was done to make use of the new internal correlation functions which</p>
<blockquote>
<div><p>are faster and more memory efficient.</p>
</div></blockquote>
<ul class="simple">
<li><p>Party.lag_calc and Family.lag_calc now work in-place on the events in
the grouping.</p></li>
<li><p>Added relative_mags method to Party and Family; this can be called from
lag-calc to avoid reprocessing data.</p></li>
<li><p>Added lag_calc.xcorr_pick_family as a public facing API to implement
correlation re-picking of a group of events.</p></li>
</ul>
</li>
<li><p>Renamed utils.clustering.cross_chan_coherence to
utils.clustering.cross_chan_correlation to better reflect what it actually
does.</p></li>
<li><p>Add –no-mkl flag for setup.py to force the FFTW correlation routines not
to compile against intels mkl.  On NeSI systems mkl is currently causing
issues.</p></li>
<li><p>BUG-FIX: <cite>eqcorrscan.utils.mag_calc.dist_calc</cite> calculated the long-way round
the Earth when changing hemispheres. We now use the Haversine formula, which
should give better results at short distances, and does not use a flat-Earth
approximation, so is better suited to larger distances as well.</p></li>
<li><p>Add C-openmp parallel distance-clustering (speed-ups of ~100 times).</p></li>
<li><p>Allow option to not stack correlations in correlation functions.</p></li>
<li><p>Use compiled correlation functions for correlation clustering (speed-up).</p></li>
<li><p>Add time-clustering for catalogs and change how space-time cluster works
so that it uses the time-clustering, rather than just throwing out events
outside the time-range.</p></li>
<li><p>Changed all prints to calls to logging, as a result, debug is no longer
an argument for function calls.</p></li>
<li><p><cite>find-peaks</cite> replaced by compiled peak finding routine - more efficient
both in memory and time #249 - approx 50x faster
* Note that the results of the C-func and the Python functions are slightly</p>
<blockquote>
<div><p>different.  The C function (now the default) is more stable when peaks
are small and close together (e.g. in noisy data).</p>
</div></blockquote>
</li>
<li><p>multi-find peaks makes use of openMP parallelism for more efficient
memory usage #249</p></li>
<li><p>enforce normalization of continuous data before correlation to avoid float32
overflow errors that result in correlation errors (see pr #292).</p></li>
<li><p>Add SEC-C style chunked cross-correlations.  This is both faster and more
memory efficient.  This is now used by default with an fft length of
2 ** 13.  This was found to be consistently the fastest length in testing.
This can be changed by the user by passing the <cite>fft_len</cite> keyword argument.
See PR #285.</p></li>
<li><p>Outer-loop parallelism has been disabled for all systems now. This was not
useful in most situations and is hard to maintain.</p></li>
<li><p>Improved support for compilation on RedHat systems</p></li>
<li><p>Refactored match-filter into smaller files. Namespace remains the same.
This was done to ease maintenance - the match_filter.py file had become
massive and was slow to load and process in IDEs.</p></li>
<li><p>Refactored <cite>_prep_data_for_correlation</cite> to reduce looping for speed,
now approximately six times faster than previously (minor speed-up)
* Now explicitly doesn’t allow templates with different length traces -</p>
<blockquote>
<div><p>previously this was ignored and templates with different length
channels to other templates had their channels padded with zeros or
trimmed.</p>
</div></blockquote>
</li>
<li><p>Add <cite>skip_short_channels</cite> option to template generation.  This allows users
to provide data of unknown length and short channels will not be used, rather
than generating an error. This is useful for downloading data from
datacentres via the <cite>from_client</cite> method.</p></li>
<li><p>Remove pytest_namespace in conftest.py to support pytest 4.x</p></li>
<li><p>Add <cite>ignore_bad_data</cite> kwarg for all processing functions, if set to True
(defaults to False for continuity) then any errors related to bad data at
process-time will be supressed and empty traces returned.  This is useful
for downloading data from  datacentres via the <cite>from_client</cite> method when
data quality is not known.</p></li>
<li><p>Added relative amplitude measurements as
<cite>utils.mag_calc.relative_amplitude</cite> (#306).</p></li>
<li><p>Added relative magnitude calculation using relative amplitudes weighted by
correlations to <cite>utils.mag_calc.relative_magnitude</cite>.</p></li>
<li><p>Added <cite>relative_magnitudes</cite> argument to
<cite>eqcorrscan.core.match_filter.party.Party.lag_calc</cite> to provide an in-flow
way to compute relative magnitudes for detected events.</p></li>
<li><p>Events constructed from detections now include estimated origins alongside
the picks. These origins are time-shifted versions of the template origin and
should be used with caution. They are corrected for prepick (#308).</p></li>
<li><p>Picks in detection.event are now corrected for prepick <em>if</em> the template is
given. This is now standard in all Tribe, Party and Family methods. Picks will
not be corrected for prepick in match_filter (#308).</p></li>
<li><p>Fix #298 where the header was repeated in detection csv files. Also added
a <cite>write_detections</cite> function to <cite>eqcorrscan.core.match_filter.detection</cite>
to streamline writing detections.</p></li>
<li><p>Remove support for Python 2.7.</p></li>
<li><p>Add warning about unused data when using <cite>Tribe.detect</cite> methods with data that
do not fit into chunks. Fixes #291.</p></li>
<li><p>Fix #179 when decimating for cccsum_hist in <cite>_match_filter_plot</cite></p></li>
<li><p><cite>utils.pre_processing</cite> now uses the <cite>.interpolate</cite> method rather than
<cite>.resample</cite> to change the sampling rate of data. This is generally more
stable and faster than resampling in the frequency domain, but will likely
change the quality of correlations.</p></li>
<li><p>Removed depreciated <cite>template_gen</cite> functions and <cite>bright_lights</cite> and
<cite>seismo_logs</cite>. See #315</p></li>
</ul>
<p>—</p>
</section>
<section id="older-versions">
<h2><span class="section-number">3.4. </span>Older Versions<a class="headerlink" href="#older-versions" title="Permalink to this headline">¶</a></h2>
<section id="version-0-3-3">
<h3><span class="section-number">3.4.1. </span>Version 0.3.3<a class="headerlink" href="#version-0-3-3" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>Make test-script more stable - use the installed script for testing.</p></li>
<li><p>Fix bug where <cite>set_xcorr</cite> as context manager did not correctly reset
stream_xcorr methods.</p></li>
<li><p>Correct test-script (<cite>test_eqcorrscan.py</cite>) to find paths properly.</p></li>
<li><p>BUG-FIX in <cite>Party.decluster</cite> when detections made at exactly the same time
the first, rather than the highest of these was taken.</p></li>
<li><p>Catch one-sample difference in day properly in pre-processing.dayproc</p></li>
<li><p>Shortproc now clips and pads to the correct length asserted by starttime and
endtime.</p></li>
<li><p>Bug-fix: Match-filter collection objects (Tribe, Party, Family) implemented
addition (<cite>__add__</cite>) to alter the main object. Now the main object is left
unchanged.</p></li>
<li><p><cite>Family.catalog</cite> is now an immutable property.</p></li>
</ul>
</section>
<section id="version-0-3-2">
<h3><span class="section-number">3.4.2. </span>Version 0.3.2<a class="headerlink" href="#version-0-3-2" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>Implement reading Party objects from multiple files, including wildcard
expansion. This will only read template information if it was not
previously read in (which is a little more efficient).</p></li>
<li><p>Allow reading of Party objects without reading the catalog files.</p></li>
<li><p>Check quality of downloaded data in <cite>Tribe.client_detect()</cite> and remove it if it
would otherwise result in errors.</p></li>
<li><p>Add <cite>process_cores</cite> argument to <cite>Tribe.client_detect()</cite> and <cite>Tribe.detect()</cite>
to provide a separate number of cores for processing and peak-finding - both
functions are less memory efficient that fftw correlation and can result in
memory errors if using lots of cores.</p></li>
<li><p>Allow passing of <cite>cores_outer</cite> kwarg through to fftw correlate functions to
control inner/outer thread numbers. If given, <cite>cores</cite> will define the number
of inner-cores (used for parallel fft calculation) and <cite>cores_outer</cite> sets
the number of channels to process in parallel (which results in increased
memory usage).</p></li>
<li><p>Allow Tribe and Party IO to use QUAKEML or SC3ML format for catalogs (NORDIC
to come once obspy updates).</p></li>
<li><p>Allow Party IO to not write detection catalogs if so desired, because
writing and reading large catalogs can be slow.</p></li>
<li><p>If detection-catalogs are not read in, then the detection events will be
generated on the fly using <cite>Detection._calculate_event</cite>.</p></li>
<li><p>BUG-FIX: When one template in a set of templates had a channel repeated,
all detections had an extra, spurious pick in their event object. This
should no-longer happen.</p></li>
<li><p>Add <cite>select</cite> method to <cite>Party</cite> and <cite>Tribe</cite> to allow selection of a
specific family/template.</p></li>
<li><p>Add ability to “retry” downloading in <cite>Tribe.client_detect</cite>.</p></li>
<li><p>Change behaviour of template_gen for data that are daylong, but do not start
within 1 minute of a day-break - previous versions enforced padding to
start and end at day-breaks, which led to zeros in the data and undesirable
behaviour.</p></li>
<li><p>BUG-FIX: Normalisation errors not properly passed back from internal fftw
correlation functions, gaps not always properly handled during long-period
trends - variance threshold is now raised, and Python checks for low-variance
and applies gain to stabilise correlations if needed.</p></li>
<li><p>Plotting functions are now tested and have a more consistent interface:</p>
<ul>
<li><p>All plotting functions accept the keyword arguments <cite>save</cite>, <cite>savefile</cite>,
<cite>show</cite>, <cite>return_figure</cite> and <cite>title</cite>.</p></li>
<li><p>All plotting functions return a figure.</p></li>
<li><p><cite>SVD_plot</cite> renamed to <cite>svd_plot</cite></p></li>
</ul>
</li>
<li><p>Enforce pre-processing even when no filters or resampling is to be done
to ensure gaps are properly processed (when called from <cite>Tribe.detect</cite>,
<cite>Template.detect</cite> or <cite>Tribe.client_detect</cite>)</p></li>
<li><p>BUG-FIX in <cite>Tribe.client_detect</cite> where data were processed from data
one sample too long resulting in minor differences in data processing
(due to difference in FFT length) and therefore minor differences
in resulting correlations (~0.07 per channel).</p>
<ul>
<li><p>Includes extra stability check in fftw_normxcorr which affects the
last sample before a gap when that sample is near-zero.</p></li>
</ul>
</li>
<li><p>BUG-FIX: fftw correlation dot product was not thread-safe on some systems.
The dot-product did not have the inner index protected as a private variable.
This did not appear to cause issues for Linux with Python 3.x or Windows, but
did cause issues for on Linux for Python 2.7 and Mac OS builds.</p></li>
<li><p>KeyboardInterrupt (e.g. ctrl-c) should now be caught during python parallel
processes.</p></li>
<li><p>Stopped allowing outer-threading on OSX, clang openMP is not thread-safe
for how we have this set-up. Inner threading is faster and more memory
efficient anyway.</p></li>
<li><p>Added testing script (<cite>test_eqcorrscan.py</cite>, which will be installed to your
path on installation of EQcorrscan) that will download all the relevant
data and run the tests on the installed package - no need to clone
EQcorrscan to run tests!</p></li>
</ul>
</section>
<section id="version-0-3-1">
<h3><span class="section-number">3.4.3. </span>Version 0.3.1<a class="headerlink" href="#version-0-3-1" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>Cleaned imports in utils modules</p></li>
<li><p>Removed parallel checking loop in archive_read.</p></li>
<li><p>Add better checks for timing in lag-calc functions (#207)</p></li>
<li><p>Removed gap-threshold of twice the template length in <cite>Tribe.client_detect</cite>, see
issue #224.</p></li>
<li><p>Bug-fix: give multi_find_peaks a cores kwarg to limit thread
usage.</p></li>
<li><p>Check for the same value in a row in continuous data when computing
correlations and zero resulting correlations where the whole window
is the same value repeated (#224, #230).</p></li>
<li><p>BUG-FIX: template generation <cite>from_client</cite> methods for swin=P_all or S_all
now download all channels and return them (as they should). See #235 and #206</p></li>
<li><p>Change from raising an error if data from a station are not long enough, to
logging a critical warning and not using the station.</p></li>
<li><p>Add ability to give multiple <cite>swin</cite> options as a list. Remains backwards
compatible with single <cite>swin</cite> arguments.</p></li>
<li><p>Add option to <cite>save_progress</cite> for long running <cite>Tribe</cite> methods. Files
are written to temporary files local to the caller.</p></li>
<li><p>Fix bug where if gaps overlapped the endtime set in pre_processing an error
was raised - happened when downloading data with a deliberate pad at either
end.</p></li>
</ul>
</section>
<section id="version-0-3-0">
<h3><span class="section-number">3.4.4. </span>Version 0.3.0<a class="headerlink" href="#version-0-3-0" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>Compiled peak-finding routine written to speed-up peak-finding.</p></li>
<li><p>Change default match-filter plotting to not decimate unless it has to.</p></li>
<li><p>BUG-FIX: changed minimum variance for fftw correlation backend.</p></li>
<li><p>Do not try to process when no processing needs to be done in
core.match_filter._group_process.</p></li>
<li><p>Length checking in core.match_filter._group_process done in samples rather
than time.</p></li>
<li><p>BUG-FIX: Fix bug where data lengths were not correct in
match_filter.Tribe.detect when sampling time-stamps were inconsistent between
channels, which previously resulted in error.</p></li>
<li><p>BUG-FIX: Fix memory-leak in tribe.construct</p></li>
<li><p>Add plotting options for plotting rate to Party.plot</p></li>
<li><p>Add filtering detections by date as Party.filter</p></li>
<li><p>BUG-FIX: Change method for Party.rethreshold: list.remove was not reliable.</p></li>
<li><p>Add option <cite>full_peaks</cite> to detect methods to map to find_peaks.</p></li>
<li><p>pre-processing (and match-filter object methods) are now gap-aware and will
accept gappy traces and can return gappy traces. By default gaps are filled to
maintain backwards compatibility. Note that the fftw correlation backend
requires gaps to be padded with zeros.</p></li>
<li><p><strong>Removed sfile_utils</strong> This support for Nordic IO has been upgraded and moved
to obspy for obspy version 1.1.0.  All functions are there and many bugs have
been fixed. This also means the removal of nordic-specific functions in
EQcorrscan - the following functions have been removed:
* template_gen.from_sfile
* template_gen.from_contbase
* mag_calc.amp_pick_sfile
* mag_calc.pick_db
All removed functions will error and tell you to use obspy.io.nordic.core.
This now means that you can use obspy’s <cite>read_events</cite> to read in sfiles.</p></li>
<li><p>Added <cite>P_all</cite> and <cite>S_all</cite> options to template generation functions
to allow creation of multi-channel templates starting at the P and S
times respectively.</p></li>
<li><p>Refactored <cite>template_gen</cite>, all options are available via
<cite>template_gen(method=…)</cite>, and depreciation warnings are in place.</p></li>
<li><p>Added some docs for converting older templates and detections into Template
and Party objects.</p></li>
</ul>
</section>
<section id="version-0-2-7">
<h3><span class="section-number">3.4.5. </span>Version 0.2.7<a class="headerlink" href="#version-0-2-7" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>Patch multi_corr.c to work with more versions of MSVC;</p></li>
<li><p>Revert to using single-precision floats for correlations (as in previous,
&lt; 0.2.x versions) for memory efficiency.</p></li>
</ul>
</section>
<section id="version-0-2-6">
<h3><span class="section-number">3.4.6. </span>Version 0.2.6<a class="headerlink" href="#version-0-2-6" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>Added the ability to change the correlation functions used in detection
methods through the parameter xcorr_func of match_filter, Template.detect
and Tribe.detect, or using the set_xcorr context manager in
the utils.correlate module. Supported options are:
* numpy
* fftw
* time-domain
* or passing a function that implements the xcorr interface.</p></li>
<li><p>Added the ability to change the concurrency strategy of xcorr functions
using the paramter concurrency of match_filter, Template.detect
and Tribe.detect. Supported options are:
* None - for single-threaded execution in a single process
* multithread - for multi-threaded execution
* multiprocess- for multiprocess execution
* concurrent - allows functions to describe their own preferred currency methods, defaults to multithread</p></li>
<li><p>Change debug printing output, it should be a little quieter;</p></li>
<li><p>Speed-up time-domain using a threaded C-routine - separate from frequency
domain C-routines;</p></li>
<li><p>Expose useful parallel options for all correlation routines;</p></li>
<li><p>Expose cores argument for match-filter objects to allow limits to be placed
on how much of your machine is used;</p></li>
<li><p>Limit number of workers created during pre-processing to never be more than
the number of traces in the stream being processed;</p></li>
<li><p>Implement openMP parallelisation of cross-correlation sum routines - memory
consumption reduced by using shared memory, and by computing the
cross-correlation sums rather than individual channel cross-correlations.
This also leads to a speed-up.  This routine is the default concurrent
correlation routine;</p></li>
<li><p>Test examples in rst doc files to ensure they are up-to-date;</p></li>
<li><p>Tests that were prone to timeout issues have been migrated to run on circleci
to allow quick re-starting of fails not due to code errors</p></li>
</ul>
</section>
<section id="version-0-2-5">
<h3><span class="section-number">3.4.7. </span>Version 0.2.5<a class="headerlink" href="#version-0-2-5" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>Fix bug with _group_process that resulted in stalled processes.</p></li>
<li><p>Force NumPy version</p></li>
<li><p>Support indexing of Tribe and Party objects by template-name.</p></li>
<li><p>Add tests for lag-calc issue with preparing data</p></li>
<li><p>Change internals of <em>eqcorrscan.core.lag_calc._prepare_data</em> to use a
dictionary for delays, and to work correctly! Issues arose from not checking
for masked data properly and not checking length properly.</p></li>
<li><p>Fix bug in match_filter.match_filter when checking for equal length traces,
length count was one sample too short.</p></li>
</ul>
</section>
<section id="version-0-2-4">
<h3><span class="section-number">3.4.8. </span>Version 0.2.4<a class="headerlink" href="#version-0-2-4" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>Increase test coverage (edge-cases) in template_gen;</p></li>
<li><p>Fix bug in template_gen.extract_from_stack for duplicate channels in
template;</p></li>
<li><p>Increase coverage somewhat in bright_lights, remove non-parallel
option (previously only used for debugging in development);</p></li>
<li><p>Increase test coverage in lag_calc;</p></li>
<li><p>Speed-up tests for brightness;</p></li>
<li><p>Increase test coverage for match_filter including testing io of
detections;</p></li>
<li><p>Increase subspace test coverage for edge cases;</p></li>
<li><p>Speed-up catalog_to_dd_tests;</p></li>
<li><p>Lag-calc will pick S-picks on channels ending E, N, 1 and 2, change
from only picking on E and N before; warning added to docs;</p></li>
<li><p>Add full tests for pre-processing;</p></li>
<li><p>Run tests in parallel on ci, speed-up tests dramatically;</p></li>
<li><p>Rename singular-value decomposition functions (with depreciation
warnings);</p></li>
<li><p>Rename SVD_moments to lower-case and add depreciation warning;</p></li>
<li><p>Increase test coverage in utils.mag_calc;</p></li>
<li><p>Add Template, Tribe, Family, Party objects and rename DETECTION to Detection
* Template objects maintain meta-data associated with their creation to stream-line processing of data (e.g. reduce chance of using the wrong filters).
* Template events have a detect method which takes unprocessed data and does the correct processing using the Template meta-data, and computes the matched-filter detections.
* Tribe objects are containers for multiple Templates.
* Tribe objects have a detect method which groups Templates with similar meta-data (processing information) and runs these templates in parallel through the matched-filter routine. Tribe.detect outputs a Party of Family objects.
* The Party object is a container for many Family objects.
* Family objects are containers for detections from the same Template.
* Family and Party objects have a lag_calc method which computes the cross-correlation pick-refinements.
* The upshot of this is that it is possible to, in one line, generate a Tribe of templates, compute their matched-filter detections, and generate cross-correlation pick refinements, which output Event objects, which can be written to a catalog: Tribe.construct(method, <a href="#id1"><span class="problematic" id="id2">**</span></a>kwargs).detect(st, <a href="#id3"><span class="problematic" id="id4">**</span></a>kwargs).lag_calc(<a href="#id5"><span class="problematic" id="id6">**</span></a>kwargs).write()
* Added 25 tests for these methods.
* Add parameters <em>threshold_type</em> and <em>threshold_input</em> to Detection class.  Add support for legacy Detection objects via NaN and unset values.</p></li>
<li><p>Removed support for obspy &lt; 1.0.0</p></li>
<li><p>Update / correct doc-strings in template-gen functions when describing
processing parameters.</p></li>
<li><p>Add warning message when removing channels from continuous data in
match_filter;</p></li>
<li><p>Add min_snr option for template generation routines, if the
signal-to-noise ratio is below a user-defined threshold, the channel
will not be used.</p></li>
<li><p>Stop enforcing two-channel template channel names.</p></li>
<li><p>Fix bug in detection_multiplot which didn’t allow streams with
fewer traces than template;</p></li>
<li><p>Update internals to custom C fftw-based correlation rather than openCV (Major change);
* OpenCV has been removed as a dependancy;
* eqcorrscan.core.match_filter.normxcorr2 now calls a compiled C routine;
* Parallel workflows handled by openMP rather than Python Multiprocessing for matched-filter operations to allow better memory handling.
* It is worth noting that we tried re-writing using SciPy internals which led to a significant speed-up, but with high memory costs, we ended up going with this option, which was the more difficult option, because it allows effective use on SLURM managed systems where python multiprocessing results in un-real memory spikes (issue #88).</p></li>
</ul>
</section>
<section id="version-0-2-0-0-2-3">
<h3><span class="section-number">3.4.9. </span>Version 0.2.0-0.2.3<a class="headerlink" href="#version-0-2-0-0-2-3" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>See 0.2.4: these versions were not fully released while trying to get
anaconda packages to build properly.</p></li>
</ul>
</section>
<section id="version-0-1-6">
<h3><span class="section-number">3.4.10. </span>Version 0.1.6<a class="headerlink" href="#version-0-1-6" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>Fix bug introduced in version 0.1.5 for match_filter where looping
through multiple templates did not correctly match image and template
data: 0.1.5 fix did not work;</p></li>
<li><p>Bug-fix in catalog_to_dd for events without magnitudes;</p></li>
<li><p>Amend match-filter to not edit the list of template names in place.
Previously, if a template was not used (due to no matching continuous
data) then the name of the template was removed: this now copies the
list of template_names internally and does not change the external list.</p></li>
</ul>
</section>
<section id="version-0-1-5">
<h3><span class="section-number">3.4.11. </span>Version 0.1.5<a class="headerlink" href="#version-0-1-5" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>Migrate coverage to codecov;</p></li>
<li><p>Fix bug introduced in version 0.1.5 for match_filter where looping
through multiple templates did not correctly match image and template
data.</p></li>
</ul>
</section>
<section id="version-0-1-4">
<h3><span class="section-number">3.4.12. </span>Version 0.1.4<a class="headerlink" href="#version-0-1-4" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>Bug-fix in plot_repicked removed where data were not normalized properly;</p></li>
<li><p>Bug-fix in lag_calc where data were missing in the continuous data fixed (this led to incorrect picks, <strong>major bug!</strong>);</p></li>
<li><p>Output cross-channel correlation sum in lag-calc output;</p></li>
<li><p>Add id to DETECTION objects, which is consistent with the events within DETECTION objects and catalog output, and used in lag_calc to allow linking of detections to catalog events;</p></li>
<li><p>Add lots of logging and error messages to lag-calc to ensure user understands limits;</p></li>
<li><p>Add error to day-proc to ensure user is aware of risks of padding;</p></li>
<li><p>Change utils.pre_processing.process to accept different length of data enforcement, not just full day (allow for overlap in processing, which might be useful for reducing day start and end effects);</p></li>
<li><p>Bug-fix in mag_calc.amp_pick_event, broke loop if data were missing;</p></li>
<li><p>Lots of docs adjustment to sort order of doc-strings and hyper-links;</p></li>
<li><p>Allow multiple uses of the same channel in templates (e.g. you can now use a template with two windows from the same channel, such as a P and an S);</p></li>
<li><p>Add evaluation mode filter to utils.catalog_utils.filter_picks;</p></li>
<li><p>Update subspace plot to work when detector is not partitioned;</p></li>
<li><p>Make tests run a little faster;</p></li>
<li><p>Add pep8 testing for all code.</p></li>
</ul>
</section>
<section id="version-0-1-3">
<h3><span class="section-number">3.4.13. </span>Version 0.1.3<a class="headerlink" href="#version-0-1-3" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>Now testing on OSX (python 2.7 and 3.5) - also added linux python 3.4;</p></li>
<li><p>Add lag-calculation and tests for it;</p></li>
<li><p>Change how lag-calc does the trace splitting to reduce memory usage;</p></li>
<li><p>Added pick-filtering utility to clean up tutorials;</p></li>
<li><p>Change template generation function names for clarity (wrappers for depreciated names);</p></li>
<li><p>Add more useful error messages when picks are not associated with waveforms;</p></li>
<li><p>Add example plots for more plotting functions;</p></li>
<li><p>Add subspace detector including docs and tutorial.</p></li>
<li><p>Add <em>delayed</em> option to all template_gen functions, set to True by default which retains old behaviour.</p></li>
</ul>
</section>
<section id="version-0-1-2">
<h3><span class="section-number">3.4.14. </span>Version 0.1.2<a class="headerlink" href="#version-0-1-2" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>Add handling for empty location information in sfiles;</p></li>
<li><p>Added project setup script which creates a useful directory structure and copies a default match-filter script to the directory;</p></li>
<li><p>Add archive reader helper for default script, and parameter classes and definitions for default script;</p></li>
<li><p>Re-write history to make repository smaller, removed trash files that had been added carelessly;</p></li>
<li><p>Now tested on appveyor, so able to be run on Windows;</p></li>
<li><p>Added ability to read hypoDD/tomoDD phase files to obspy events;</p></li>
<li><p>Added simple despiking algorithm - not ideal for correlation as spikes are interpolated around when found: eqcorrscan.utils.despike;</p></li>
<li><p>Option to output catalog object from match_filter - this will become the default once we introduce meta-data to templates - currently the picks for events are the template trace start-times, which will be before the phase-pick by the lag defined in the template creation - also added event into detection class, so you can access the event info from the detections, or create a catalog from a list of detections;</p></li>
<li><p>Add option to extract detections at run-time in match_filter.match_filter;</p></li>
<li><p>Edited multi_event_singlechan to take a catalog with multiple picks, but requires you to specify the station and channel to plot;</p></li>
<li><p>Add normalize option to stacking routines;</p></li>
<li><p>Add tests for stacking - PWS test needs more checks;</p></li>
<li><p>Add many examples to doc-strings, not complete though;</p></li>
<li><p>Change docs to have one page per function.</p></li>
<li><p>Python 3.5 testing underway, all tests pass, but only testing about 65% of codebase.</p></li>
<li><p>Add io functions to match_filter to simplify detection handling including writing detections to catalog and to text file.</p></li>
<li><p>Stricter match_filter testing to enforce exactly the same result with a variety of systems.</p></li>
<li><p>Add hack to template_gen tutorial to fix differences in sorting between python 3.x and python 2.</p></li>
<li><p>Added advanced network triggering routine from Konstantinos, allows different parameters for individual stations - note only uses recursive sta-lta triggering at the moment.  Useful for template generations alongside pickers.</p></li>
<li><p>Added magnitude of completeness and b-value calculators to utils.mag_calc</p></li>
</ul>
</section>
<section id="version-0-1-1">
<h3><span class="section-number">3.4.15. </span>Version 0.1.1<a class="headerlink" href="#version-0-1-1" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>Cope with events not always having time_errors in them in eventtoSfile;</p></li>
<li><p>Convert Quakeml depths from m to km;</p></li>
<li><p>Multiple little fixes to make Sfile conversion play well with GeoNet QuakeML files;</p></li>
<li><p>Add function to convert from obspy.core.inventory.station.Station to string format for Seisan STATION0.HYP file;</p></li>
<li><p>Merged feature branch - hypoDD into develop, this provides mappings for the hypoDD location program, including generation of dt.cc files;</p></li>
<li><p>Added tests for functions in catalog_to_dd;</p></li>
<li><p>Implemented unittest tests;</p></li>
<li><p>Changed name of EQcorrscan_plotting to plotting;</p></li>
<li><p>Added depreciation warnings;</p></li>
<li><p>Changed internal structure of pre-processing to aid long-term upkeep;</p></li>
<li><p>Added warnings in docs for template_gen relating to template generation from set length files;</p></li>
<li><p>Updated template_creation tutorial to use day-long data;</p></li>
<li><p>Renamed Sfile_util to sfile_util, and functions there-in: will warn about name changes;</p></li>
<li><p>Updated template plotting to include pick labels;</p></li>
<li><p>Updated template_creation tutorial to download S-picks as well as P-picks;</p></li>
<li><p>Update sfile_util to cope with many possible unfilled objects;</p></li>
<li><p>Added sac_util to convert from sac headers to useful event information - note, does not convert all things, just origin and pick times;</p></li>
<li><p>Added from_sac function to template_gen.</p></li>
</ul>
</section>
</section>
</section>


    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
    <p class="pull-right">
      <a href="#">Back to top</a>
      
    </p>
    <p>
        &copy; Copyright 2015-2021: EQcorrscan developers.<br/>
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 3.2.1.<br/>
    </p>
  </div>
</footer>
  </body>
</html>