.appinfo-area
    .app-empty(ng-if="!app.data")

    .info-container(ng-if="app.view == 'info' && app.data" ng-cloak)
        .img-responsive(ng-if="app.data.featured" style="position: relative; background-image: url('{{app.data.featured}}')")
            svg(viewBox="0 0 32 9")
                rect(width="32" height="9" style="fill:rgba(255,255,255,0);")
            
        .container.mt-4(style="max-width: 720px;")
            .d-flex.mb-4
                .app-title
                    h2.mb-0 {{app.data.title}}
                    h3.mb-0
                        span.text-primary {{app.data.user_id}}
                        small.ml-2.text-muted /
                        small.ml-2.text-muted {{app.data.id}}
                .avatar-area.ml-auto
                    .avatar-container
                        span.avatar(style="background-image: url({{app.data.logo}})")

            textarea#app-description

    .app-editor(ng-if="app.view == 'editor' && app.data" ng-cloak)
        .top-menu
            .header
                .header-title {{ app.data.id ? app.data.title : 'New App' }}
                .ml-auto
                .side-btns(ng-if="app.view == 'editor'")
                    .btn.btn-sm.mr-1(ng-class="layout.active_layout % 3 == 1 ? 'btn-orange' : 'btn-primary'")
                        .layout-selector(ng-class="layout.active_layout % 3 == 1 ? 'active' : ''" ng-click="layout.change(layout.active_layout > 3 ? 4 : 1)")
                            .layout-icon
                                .layout-row
                                    .layout-column
                    .btn.btn-sm.mr-1(ng-class="layout.active_layout % 3 == 2 ? 'btn-orange' : 'btn-primary'")
                        .layout-selector(ng-class="layout.active_layout % 3 == 2 ? 'active' : ''" ng-click="layout.change(layout.active_layout > 3 ? 5 : 2)")
                            .layout-icon
                                .layout-row
                                    .layout-column
                                    .layout-column
                    .btn.btn-sm.mr-1(ng-class="layout.active_layout % 3 == 0 ? 'btn-orange' : 'btn-primary'")
                        .layout-selector(ng-class="layout.active_layout % 3 == 0 ? 'active' : ''" ng-click="layout.change(layout.active_layout > 3 ? 6 : 3)")
                            .layout-icon
                                .layout-row
                                    .layout-column
                                    .layout-column
                                    .layout-column
        
        .appinfo-context
            mixin info(tab)
                .card.no-border.mb-4
                    ul.nav.nav-tabs.nav-fill(data-bs-toggle="tabs")
                        li.nav-item
                            a.nav-link.active(href="#info" data-bs-toggle="tab") Info
                        li.nav-item
                            a.nav-link(href="#desc" data-bs-toggle="tab") Desc
                        li.nav-item
                            a.nav-link(href="#variables" data-bs-toggle="tab") Variables
                        li.nav-item(ng-if="app.data.mode == 'ui'")
                            a.nav-link(href="#cdn" data-bs-toggle="tab") CDNs
                        li.nav-item
                            a.nav-link(href="#delete" data-bs-toggle="tab") Delete
                    .card-body.p-0
                        .tab-content
                            #info.tab-pane.show.active.p-4
                                .form-group.row.mb-3(ng-if="app.data.id")
                                    label.form-label.col-3.col-form-label App ID
                                    .col
                                        input.form-control(type="text" ng-model="app.data.id" disabled="disabled")
                                
                                .form-group.row.mb-3
                                    label.form-label.col-3.col-form-label App Title
                                    .col
                                        input.form-control(type="text" placeholder="App Title" ng-model="app.data.title")
                                
                                .form-group.row.mb-3
                                    label.form-label.col-3.col-form-label App Version
                                    .col
                                        input.form-control(type="text" placeholder="1.0.0" ng-model="app.data.version")

                                .form-group.row.mb-3
                                    label.form-label.col-3.col-form-label Visibility
                                    .col
                                        .form-selectgroup
                                            label.form-selectgroup-item
                                                input.form-selectgroup-input(type="radio" name="visibility" value="private" ng-model="app.data.visibility")
                                                span.form-selectgroup-label
                                                    i.fa-solid.fa-lock.mr-2
                                                    span Private
                                            label.form-selectgroup-item
                                                input.form-selectgroup-input(type="radio" name="visibility" value="hub" ng-model="app.data.visibility")
                                                span.form-selectgroup-label
                                                    i.fa-brands.fa-hubspot.mr-2
                                                    span Hub
                                        .mt-2
                                            span.text-muted(ng-if="app.data.visibility == 'private'") This app is for your own use only.
                                            span.text-muted(ng-if="app.data.visibility == 'hub'") This app is shared with hub users.

                                .form-group.row.mb-3
                                    label.form-label.col-3.col-form-label Mode
                                    .col
                                        .form-selectgroup
                                            label.form-selectgroup-item
                                                input.form-selectgroup-input(type="radio" name="mode" value="ui" ng-model="app.data.mode")
                                                span.form-selectgroup-label
                                                    i.fa-solid.fa-desktop.mr-2
                                                    span UI Mode

                                            label.form-selectgroup-item
                                                input.form-selectgroup-input(type="radio" name="mode" value="stream" ng-model="app.data.mode")
                                                span.form-selectgroup-label
                                                    i.fa-solid.fa-bolt.mr-2
                                                    span Stream Mode
                                        
                                        .mt-2
                                            span.text-muted(ng-if="app.data.mode == 'ui'") UI mode provides data processing to be possible through the screen. But when the workflow runs, it stops and waits for the user's interaction.
                                            span.text-muted(ng-if="app.data.mode == 'stream'") Stream mode not provides UI. However, when the workflow runs, it automatically advances the process.
                                
                                .form-group.row.mb-3
                                    label.form-label.col-3.col-form-label Logo
                                    .col.text-left
                                        .avatar-area
                                            .avatar-container
                                                span.avatar(style="background-image: url({{app.data.logo}})")

                                        input.form-control#file-logo(type="file" accept="image/*" style="display: none")
                                    .col-2
                                        .btn.btn-primary.btn-block(ng-click="app.uploader.logo()") Upload
                                        .btn.btn-outline-danger.btn-block.mt-2(ng-if="app.data.logo" ng-click="app.data.logo = ''") Delete

                                .form-group.row.mb-3
                                    label.form-label.col-3.col-form-label Featured Image
                                    .col.text-center
                                        input.form-control#file-featured(type="file" accept="image/*" style="display: none")
                                        img(ng-if="app.data.featured" ng-src="{{app.data.featured}}" style="width: 100%;")
                                    .col-2
                                        .btn.btn-primary.btn-block(ng-click="app.uploader.featured()") Upload
                                        .btn.btn-outline-danger.btn-block.mt-2(ng-if="app.data.featured" ng-click="app.data.featured = ''") Delete
                                
                            #desc.tab-pane.show
                                textarea(id="description-editor-{$tab$}")

                            #variables.tab-pane.pt-4.pb-4
                                .card.mb-4
                                    .card-header
                                        h4.card-title Input Definition

                                    .card-body.p-0.input-definition-table
                                        table.table.card-table
                                            thead
                                                tr
                                                    th.text-left(colspan=2) Type
                                                    th.text-left Input Name
                                                    th.text-left Description
                                                    th.text-left
                                            tbody(ui-sortable='sortableOptions' ng-model="app.data.inputs")
                                                tr(ng-repeat="item in app.data.inputs")
                                                    td.w-1.nowrap.pl-2.text-left
                                                        label.form-selectgroup-item
                                                            input.form-selectgroup-input(type="radio" name="vartype-{{item.name}}" value="variable" ng-model="item.type")
                                                            span.form-selectgroup-label.w-96
                                                                span Variable
                                                        br
                                                        label.form-selectgroup-item
                                                            input.form-selectgroup-input(type="radio" name="vartype-{{item.name}}" value="output" ng-model="item.type")
                                                            span.form-selectgroup-label.w-96
                                                                span App Output
                                                    td.w-1(style="width: 120px !important;")
                                                        select.form-select(ng-model="item.inputtype" ng-if="item.type == 'variable'")
                                                            option(value="text") Text
                                                            option(value="password") Password
                                                            option(value="number") Number
                                                            option(value="date") Date
                                                            option(value="list") List
                                                            option(value="memo") Memo
                                                    td.w-1
                                                        input.form-control(style="width: 160px;" placeholder="Input Name" ng-model="item.name")
                                                    td
                                                        textarea.form-control(placeholder="{{ item.inputtype == 'list' ? 'samsung: 005930,\nkakao: 035720' : 'Description'}}" rows="{{ item.inputtype == 'list' ? 5 : 3}}" ng-model="item.description")
                                                    td.w-1
                                                        button.btn.btn-white.btn-sm.pt-1.pb-1(style="margin-top: 5px; margin-right: 8px;" ng-click="app.data.inputs.remove(item)")
                                                            i.fa-solid.fa-xmark
                                                        br
                                                        .draggable.btn.btn-white.btn-sm.pt-1.pb-1(style="margin-top: 5px; margin-right: 8px;")
                                                            i.fa-solid.fa-up-down-left-right
                                            tbody
                                                tr
                                                    td.p-2(colspan=5 style="background: rgba(116,108,112,.1);")
                                                        button.btn.btn-primary.btn-circle(ng-click="app.add_input()")
                                                            i.fa-solid.fa-plus

                                .card.mb-4
                                    .card-header
                                        h4.card-title Output Definition

                                    .card-body.p-0.input-definition-table
                                        table.table.card-table
                                            thead
                                                tr
                                                    th.text-left Output Name
                                                    th.text-left Description
                                                    th.text-left
                                            tbody(ui-sortable='sortableOptions' ng-model="app.data.outputs")
                                                tr(ng-repeat="item in app.data.outputs")
                                                    td.w-1
                                                        input.form-control(style="width: 160px;" placeholder="Output Name" ng-model="item.name")
                                                    td
                                                        textarea.form-control(placeholder="Description" rows=3 ng-model="item.description")
                                                    td.w-1
                                                        button.btn.btn-white.btn-sm.pt-1.pb-1(style="margin-top: 5px; margin-right: 8px;" ng-click="app.data.outputs.remove(item)")
                                                            i.fa-solid.fa-xmark
                                                        br
                                                        .draggable.btn.btn-white.btn-sm.pt-1.pb-1(style="margin-top: 5px; margin-right: 8px;")
                                                            i.fa-solid.fa-up-down-left-right
                                            tbody
                                                tr
                                                    td.p-2(colspan=3 style="background: rgba(116,108,112,.1);")
                                                        button.btn.btn-primary.btn-circle(ng-click="app.add_output()")
                                                            i.fa-solid.fa-plus

                            #delete.tab-pane.pt-4.pb-4
                                .card.mb-4(ng-if="app.data.id && workflow_id == 'develop'")
                                    .card-header
                                        h4.card-title Delete App

                                    .card-body
                                        .btn.btn-block.btn-outline-danger(ng-click="app.delete()") Delete

                            #cdn.tab-pane.pt-4.pb-4
                                .card.mb-4
                                    .card-header
                                        h4.card-title Javascript
                                        .mr-auto
                                        button.btn.btn-primary.btn-circle(ng-click="app.data.cdn.js.push({})")
                                            i.fa-solid.fa-plus

                                    .card-body.p-0.input-definition-table
                                        table.table.card-table
                                            tbody(ui-sortable='sortableOptions' ng-model="app.data.cdn.js")
                                                tr(ng-repeat="item in app.data.cdn.js")
                                                    td
                                                        input.form-control(style="width: 100%;" placeholder="https://cdn.jsdelivr.net/npm/highcharts@10.1.0/highcharts.min.js" ng-model="item.src")
                                                    td.w-1
                                                        button.btn.btn-white.btn-sm.pt-1.pb-1(style="margin-top: 5px; margin-right: 4px;" ng-click="app.data.cdn.js.remove(item)")
                                                            i.fa-solid.fa-xmark
                                                        .draggable.btn.btn-white.btn-sm.pt-1.pb-1(style="margin-top: 5px; margin-right: 8px;")
                                                            i.fa-solid.fa-up-down-left-right
                                            tbody
                                                tr
                                                    td.p-2(colspan=5 style="background: rgba(116,108,112,.1);")

                                .card.mb-4
                                    .card-header
                                        h4.card-title CSS
                                        .mr-auto
                                        button.btn.btn-primary.btn-circle(ng-click="app.data.cdn.css.push({})")
                                            i.fa-solid.fa-plus

                                    .card-body.p-0.input-definition-table
                                        table.table.card-table
                                            tbody(ui-sortable='sortableOptions' ng-model="app.data.cdn.css")
                                                tr(ng-repeat="item in app.data.cdn.css")
                                                    td
                                                        input.form-control(style="width: 100%;" placeholder="https://cdn.jsdelivr.net/npm/highcharts@10.1.0/highcharts.min.css" ng-model="item.src")
                                                    td.w-1
                                                        button.btn.btn-white.btn-sm.pt-1.pb-1(style="margin-top: 5px; margin-right: 4px;" ng-click="app.data.cdn.css.remove(item)")
                                                            i.fa-solid.fa-xmark
                                                        .draggable.btn.btn-white.btn-sm.pt-1.pb-1(style="margin-top: 5px; margin-right: 8px;")
                                                            i.fa-solid.fa-up-down-left-right
                                            tbody
                                                tr
                                                    td.p-2(colspan=5 style="background: rgba(116,108,112,.1);")

            mixin codearea(tab)
                .monaco-area(ng-if="layout.checker('{$tab$}')")
                    .code-select.bg-primary.d-flex(style="margin-top: -2px;")
                        a.btn.btn-square.btn-sm.p-2(ng-click="app.editor.tab('{$tab$}', 'info')" class="{{app.editor.tabs.{$tab$}.target == 'info' ? 'text-dark' : 'bg-primary'}}") Info
                        a.btn.btn-square.btn-sm.p-2(ng-click="app.editor.tab('{$tab$}', 'code')" class="{{app.editor.tabs.{$tab$}.target == 'code' ? 'text-dark' : 'bg-primary'}}") Code
                        a.btn.btn-square.btn-sm.p-2(ng-click="app.editor.tab('{$tab$}', 'sample')" class="{{app.editor.tabs.{$tab$}.target == 'sample' ? 'text-dark' : 'bg-primary'}}") Sample
                        a.btn.btn-square.btn-sm.p-2(ng-if="app.data.mode == 'ui'" ng-click="app.editor.tab('{$tab$}', 'api')" class="{{app.editor.tabs.{$tab$}.target == 'api' ? 'text-dark' : 'bg-primary'}}") API
                        a.btn.btn-square.btn-sm.p-2(ng-if="app.data.mode == 'ui'" ng-click="app.editor.tab('{$tab$}', 'pug')" class="{{app.editor.tabs.{$tab$}.target == 'pug' ? 'text-dark' : 'bg-primary'}}") PUG
                        a.btn.btn-square.btn-sm.p-2(ng-if="app.data.mode == 'ui'" ng-click="app.editor.tab('{$tab$}', 'js')" class="{{app.editor.tabs.{$tab$}.target == 'js' ? 'text-dark' : 'bg-primary'}}") JS
                        a.btn.btn-square.btn-sm.p-2(ng-if="app.data.mode == 'ui'" ng-click="app.editor.tab('{$tab$}', 'css')" class="{{app.editor.tabs.{$tab$}.target == 'css' ? 'text-dark' : 'bg-primary'}}") SCSS
                        a.btn.btn-square.btn-sm.p-2(ng-if="app.data.mode == 'ui'" ng-click="app.editor.tab('{$tab$}', 'preview')" class="{{app.editor.tabs.{$tab$}.target == 'preview' ? 'text-dark' : 'bg-primary'}}") Preview

                    div(ng-if="!['preview', 'info'].includes(app.editor.tabs.{$tab$}.target) && app.editor.tabs.{$tab$}.status" ng-model="app.data[app.editor.tabs.{$tab$}.target]" ui-monaco-opts="app.editor.tabs.{$tab$}.monaco" ui-monaco)
                    div(ng-if="app.editor.tabs.{$tab$}.target == 'info'" style="width: 100%; height: calc(100% - 33px); overflow-y: auto; overflow-x: hidden;")
                        .container.pt-4(style="max-width: 860px;")
                            +info(tab)
                    .code-preview(ng-if="app.editor.tabs.{$tab$}.target == 'preview'" style="max-width: none; width: 100%; height: calc(100% - 33px);")
                        iframe.preview(style="height: 100%;" ng-show="app.preview.status")

            #editor-area.code-editor(ng-if="app.view == 'editor'")
                .floating-menu
                    .btn.btn-primary.btn-circle.mr-2(ng-click="layout.change(layout.active_layout <= 3 ? layout.active_layout + 3 : layout.active_layout)" ng-if="layout.active_layout <= 3")
                        i.fa-solid.fa-terminal

                    .btn.btn-primary.btn-circle.mr-2(ng-click="app.stop()" ng-if="['running', 'pending'].includes(socket.running_status.status)")
                        i.fa-solid.fa-stop

                    .btn.btn-primary.btn-circle.mr-2(ng-click="app.run()" ng-if="app._run && (!socket.running_status.status || ['error', 'finish', 'ready'].includes(socket.running_status.status))")
                        i.fa-solid.fa-play

                    .btn.btn-primary.btn-circle(ng-click="app.save()")
                        i.fa-solid.fa-save

                div(data-split-pane data-split-pane-properties="layout.viewstate.horizonal")
                    div(data-split-pane-component data-height="70%")
                        div(data-split-pane data-split-pane-properties="layout.viewstate.vertical_1_1")
                            div(data-split-pane-component data-width="34%")
                                +codearea("tab1")

                            div(data-split-pane-divider data-width="3px")

                            div(data-split-pane-component data-width="66%")
                                div(data-split-pane data-split-pane-properties="layout.viewstate.vertical_1_2")
                                    div(data-split-pane-component data-width="50%")
                                        +codearea("tab2")
                                    div(data-split-pane-divider data-width="3px")
                                    div(data-split-pane-component data-width="50%")
                                        +codearea("tab3")

                    div(data-split-pane-divider data-height="3px")

                    div(data-split-pane-component data-height="30%")
                        div(style="overflow: hidden; height: 100%; width: 100%;")
                            .code-select.bg-primary.d-flex(style="margin-top: -2px;")
                                a.btn.btn-square.btn-sm.p-2.text-dark DEBUG
                                a.btn.btn-square.btn-primary.btn-sm.p-2.ml-auto(ng-click="socket.clear()") CLEAR
                                a.btn.btn-square.btn-primary.btn-sm.p-2(ng-click="layout.change(layout.active_layout > 3 ? layout.active_layout - 3 : layout.active_layout)")
                                    i.fa-solid.fa-xmark
                            div(style="height: calc(100% - 36px);")
                                .dizest-debug-messages(style="overflow: auto; max-width: none; width: 100%; height: 100%; background: #000; color: #fff; padding: 8px; line-height: 1;" ng-bind-html="trustAsHtml(socket.log)")


    {$ wiz.render("modal.message", "page.hub.app.editor.modal.message") $}