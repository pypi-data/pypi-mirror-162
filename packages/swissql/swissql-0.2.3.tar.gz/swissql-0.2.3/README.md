
# swissql - —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏–π –∞–Ω–∞–ª–∏–∑ SparkSQL 

![swissql](https://user-images.githubusercontent.com/53406289/183268645-0daab2dc-40d6-4bbe-b302-956bb30543ba.png)


<p align="center">
  <a href="#–ü–ª—é—à–∫–∏">–ü–ª—é—à–∫–∏</a> ‚Ä¢
  <a href="#–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª">–ö–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å?</a>  ‚Ä¢ 
  <a href="#–£—Å—Ç–∞–Ω–æ–≤–∫–∞">–£—Å—Ç–∞–Ω–æ–≤–∫–∞</a> ‚Ä¢
  <a href="#–°—Ç–µ–∫">–°—Ç–µ–∫</a> ‚Ä¢
  <a href="#–ê–≤—Ç–æ—Ä—ã">–ê–≤—Ç–æ—Ä—ã</a>
</p>

- –ö–µ–π—Å: "–°—Ç–∞—Ç–∏—á–µ—Å–∫–∏–π –∞–Ω–∞–ª–∏–∑–∞—Ç–æ—Ä SparkSQL —Å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å—é –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö –ø—Ä–∞–≤–∏–ª"
- –†–µ—à–∞—é—Ç: –∫–æ–º–∞–Ω–¥–∞ **I PRO**
- [–°—Å—ã–ª–∫–∞ –Ω–∞ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π](https://github.com/IPROSpark/SparkSQL-Analyzer)
- [–°—Å—ã–ª–∫–∞ –Ω–∞ PyPi](https://pypi.org/project/swissql/)


## –ü–æ—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–¥–∞—á–∏
–ù–µ–æ–±—Ö–æ–¥–∏–º–æ —Ä–∞–∑—Ä–∞–±–æ—Ç–∞—Ç—å —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏–π –∞–Ω–∞–ª–∏–∑–∞—Ç–æ—Ä SparkSQL –∫–æ–¥–∞. –ì—Ä–∞–º–º–∞—Ç–∏–∫–∞ –¥–æ–ª–∂–Ω–∞ —Ä–∞—Å—à–∏—Ä—è—Ç—å—Å—è —á–µ—Ä–µ–∑ –æ—Ç–¥–µ–ª—å–Ω—ã–π BNF —Ñ–∞–π–ª (https://en.wikipedia.org/wiki/Backus‚ÄìNaur_form). –ï—Å—Ç—å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –¥–æ–±–∞–≤–ª—è—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –≤ –∫–æ–¥–µ. –ï—Å—Ç—å –û–û–ü –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –∏–∑ –∫–æ–¥–∞. –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –±—ã—Å—Ç—Ä—ã–º –∏ –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã–º. 

## –†–µ—à–µ–Ω–∏–µ - –ß—Ç–æ —Ç–∞–∫–æ–µ swissql
swissql - —ç—Ç–æ python –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ –¥–ª—è —Å—Ç–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞ SparkSQL, –∫ –∫–æ—Ç–æ—Ä–æ–π —Ç–∞–∫–∂–µ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç—Å—è CLI. –û–Ω–∞ —Å–æ—Å—Ç–æ–∏—Ç –∏–∑ —Å–ª–µ–¥—É—é—â–∏—Ö –º–æ–¥—É–ª–µ–π:

- [Syntax - —Å–∏–Ω—Ç–∞–∫—Å–∏—á–µ—Å–∫–∏–π —Ä–∞–∑–±–æ—Ä –∏ –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ AST](#Syntax)
- [Format - —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ](#Format)
- [Style - —Å—Ç–∏–ª–∏—Å—Ç–∏—á–µ—Å–∫–∏–π –∞–Ω–∞–ª–∏–∑](#Style)
- [Optimize - –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è SparkSQL –∑–∞–ø—Ä–æ—Å–∞](#Optimize)
- [Anti_pattern - –≤—ã—è–≤–ª–µ–Ω–∏–µ –∞–Ω—Ç–∏–ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤](#Anti_pattern)
- [Rule - –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö –ø—Ä–∞–≤–∏–ª –Ω–∞ –æ—Å–Ω–æ–≤–µ BNF](#Rule)
- [Extract - –∞–Ω–∞–ª–∏–∑ SQL —Å—Ç—Ä–æ–∫ –≤ –∫–æ–¥–æ–≤–æ–π –±–∞–∑–µ](#Extract)
- [Query Planning - –ø–ª–∞–Ω –∑–∞–ø—Ä–æ—Å–∞](#Query_Planning)

## –ü–ª—é—à–∫–∏

...–∏–ª–∏ —á—Ç–æ –¥–µ–ª–∞–µ—Ç —ç—Ç–æ —Ä–µ—à–µ–Ω–∏–µ –æ—Å–æ–±–µ–Ω–Ω—ã–º.

- CLI –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å - —Å–¥–µ–ª–∞–µ—Ç –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é –≤ CI/CD –∫–∞–∫ –Ω–∏–∫–æ–≥–¥–∞ –ø—Ä–∏–≤—ã—á–Ω–æ–π.
- –†–∞–∑–Ω–æ—Ü–≤–µ—Ç–Ω—ã–π —Ç–µ–∫—Å—Ç –¥–ª—è –æ–±–ª–µ–≥—á–µ–Ω–∏—è –≤–∏–∑—É–∞–ª—å–Ω–æ–≥–æ –≤–æ—Å–ø—Ä–∏—è—Ç–∏—è –≤ –∫–æ–Ω—Å–æ–ª–∏.
- –£—Ç–∏–ª–∏—Ç–∞ –≤—ã–ª–æ–∂–µ–Ω–∞ –∏ –¥–æ—Å—Ç—É–ø–Ω–∞ –Ω–∞ [PyPi](https://pypi.org/project/swissql/), —á—Ç–æ –æ–±–ª–µ–≥—á–∞–µ—Ç –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é –≤ —Ä–∞–±–æ—á–∏–π –ø—Ä–æ—Ü–µ—Å—Å.
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã—Ö —Ä–µ—à–µ–Ω–∏–π - —ç—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç –±–µ–∑ –ø—Ä–æ–±–ª–µ–º –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ–µ–∫—Ç –∏ –ª–µ–≥—á–µ –∞–¥–∞–ø—Ç–∏—Ä–æ–≤–∞—Ç—å –µ–≥–æ –ø–æ–¥ –¥—Ä—É–≥–∏–µ –¥–∏–∞–ª–µ–∫—Ç—ã SQL.
- –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –≤ –∫–æ–¥–µ –ø–æ–º–æ–≥—É—Ç –±–µ–∑ –ª–∏—à–Ω–∏—Ö –ø—Ä–æ–±–ª–µ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –±–∏–±–ª–∏–æ—Ç–µ–∫—É –≤ –¥—Ä—É–≥–∏—Ö python —Å–∫—Ä–∏–ø—Ç–∞—Ö.
- –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤ –ø–æ–∑–≤–æ–ª–∏—Ç —Å—ç–∫–æ–Ω–æ–º–∏—Ç—å —Ä–µ—Å—É—Ä—Å—ã –ø—Ä–∏ —Ä–∞–±–æ—Ç–µ —Å BigQuery.


## –£—Å—Ç–∞–Ω–æ–≤–∫–∞

TODO: <...> –î–æ–ø–∏—Å–∞—Ç—å –∏ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å
```
pip install swissql
```

## –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª

–ù–∞–≥–ª—è–¥–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ swissql –æ–ø–∏—Å–∞–Ω–æ –≤ –Ω–∞—à–µ–º [–Ω–æ—É—Ç–±—É–∫–µ](https://github.com/IPROSpark/SparkSQL-Analyzer/blob/main/examples/usage_example.ipynb). –ù–∏–∂–µ –ø—Ä–∏–≤–µ–¥–µ–Ω—ã –µ–≥–æ —Ñ—Ä–∞–≥–º–µ–Ω—Ç—ã —Å –æ–±—ä—è—Å–Ω–µ–Ω–∏–µ–º —Ç–æ–≥–æ, –∫–∞–∫ –∏ —á—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç.

### Syntax
---
–°–∏–Ω—Ç–∞–∫—Å–∏—á–µ—Å–∫–∏–π —Ä–∞–∑–±–æ—Ä SparkSQL –∏ –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ AST —Å –ø–æ–º–æ—â—å—é `sqlglot` –ø–æ–∑–≤–æ–ª—è–µ—Ç –ø—Ä–æ–≤–æ–¥–∏—Ç—å RBO (rule-based) –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –≤ –º–æ–¥—É–ª–µ [Optimize](#Optimize). –ü—Ä–∏–º–µ—Ä –ø–æ—Å—Ç—Ä–æ–µ–Ω–Ω–æ–≥–æ AST:
```Bash
$ # –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –æ—Ç–¥–µ–ª—å–Ω–æ–≥–æ –º–æ–¥—É–ª—è - Syntax
!python -m swissql syntax -q "SELECT * from x join y on x.id = y.id where x.id > 2"

[Generating syntax tree using sqlglot]
(SELECT expressions: 
  (STAR ), from: 
  (FROM expressions: 
    (TABLE this: 
      (IDENTIFIER this: x, quoted: False))), joins: 
  (JOIN this: 
    (TABLE this: 
      (IDENTIFIER this: y, quoted: False)), on: 
    (EQ this: 
      (COLUMN this: 
        (IDENTIFIER this: id, quoted: False), table: 
        (IDENTIFIER this: x, quoted: False)), expression: 
      (COLUMN this: 
        (IDENTIFIER this: id, quoted: False), table: 
        (IDENTIFIER this: y, quoted: False)))), where: 
  (WHERE this: 
    (GT this: 
      (COLUMN this: 
        (IDENTIFIER this: id, quoted: False), table: 
        (IDENTIFIER this: x, quoted: False)), expression: 
      (LITERAL this: 2, is_string: False))))
```

### Style
---
–° –ø–æ–º–æ—â—å—é `sqlfluff` –º—ã –ø–æ–ª—É—á–∞–µ–º —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ —Å—Ç–∏–ª—é –∫–æ–¥–∞. –ü—Ä–∏–º–µ—Ä —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π –º–æ–∂–Ω–æ —É–≤–∏–¥–µ—Ç—å –Ω–∏–∂–µ:
```bash
# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –æ—Ç–¥–µ–ª—å–Ω–æ–≥–æ –º–æ–¥—É–ª—è - Style
!python -m swissql style -q "SELECT * from x join y on x.id = y.id where x.id > 2"

[Style sql query use sqlfluff]
/home/quakumei/Workspace/Code/sparkySQL/SparkSQL-Analyzer/swissql/analyzers/style/intermediate.sql
== [/home/quakumei/Workspace/Code/sparkySQL/SparkSQL-Analyzer/swissql/analyzers/style/intermediate.sql] FAIL
L:   1 | P:   1 | L044 | Query produces an unknown number of result columns.
L:   1 | P:   8 | L027 | Unqualified reference '*' found in select with more than
                       | one referenced table/view.
L:   1 | P:  10 | L010 | Keywords must be consistently upper case.
L:   1 | P:  17 | L010 | Keywords must be consistently upper case.
L:   1 | P:  17 | L051 | Join clauses should be fully qualified.
L:   1 | P:  24 | L010 | Keywords must be consistently upper case.
L:   1 | P:  39 | L010 | Keywords must be consistently upper case.
L:   1 | P:  53 | L009 | Files must end with a single trailing newline.
All Finished!

```

### Format
---
–§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–¥–∞ –æ—Å—É—â–µ—Å—Ç–≤–ª—è–µ—Ç—Å—è —Ç–∞–∫ –∂–µ —Å –ø–æ–º–æ—â—å—é sqlglot. –ü—Ä–∏–º–µ—Ä –æ—Ç—Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞:

```SQL
[Formatting sql query using sqlglot]
SELECT
  *
FROM x
JOIN y
  ON x.id = y.id
WHERE
  x.id > 2

```

### Optimize
---

–ü–µ—Ä–≤–∏—á–Ω–∞—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –∑–∞–ø—Ä–æ—Å–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç—Å—è —Å –ø–æ–º–æ—â—å—é `sqlglot` –Ω–∞ –æ—Å–Ω–æ–≤–µ –ø–æ—Å—Ç—Ä–æ–µ–Ω–Ω–æ–≥–æ —Ä–∞–Ω–µ–µ AST –¥–µ—Ä–µ–≤–∞ –∏ —Å—Ö–µ–º—ã –¥–∞–Ω–Ω—ã—Ö. –ü–æ–ª–Ω—ã–π —Å–ø–∏—Å–æ–∫ 
–æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–π –∑–∞–ø—Ä–æ—Å–∞ –≤–∫–ª—é—á–∞–∞–µ—Ç –≤ —Å–µ–±—è —Ç–∞–∫–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –∫–∞–∫

```python
    expression = qualify_tables(expression, db=db, catalog=catalog)
    expression = isolate_table_selects(expression)
    expression = qualify_columns(expression, schema)
    expression = pushdown_projections(expression)
    expression = normalize(expression)
    expression = unnest_subqueries(expression)
    expression = expand_multi_table_selects(expression)
    expression = pushdown_predicates(expression)
    expression = optimize_joins(expression)
    expression = eliminate_subqueries(expression)
    expression = quote_identities(expression)
    return expression
```

–ü—Ä–∏–º–µ—Ä –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞:

```SQL
# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –æ—Ç–¥–µ–ª—å–Ω–æ–≥–æ –º–æ–¥—É–ª—è - Optimize
!python -m swissql optimize -q "SELECT * from x join y on x.id = y.id where x.id > 2" -s '{"x":{"id":"INT", "name":"STRING"},"y":{"id":"INT","name":"STRING"}}' -o optimize

[Optimizing sql query using sqlglot]
Optimization: optimize
SELECT
  "x"."id" AS "id",
  "x"."name" AS "name",
  "y"."id" AS "id",
  "y"."name" AS "name"
FROM (
  SELECT
    "x"."id" AS "id",
    "x"."name" AS "name"
  FROM "x" AS "x"
  WHERE
    "x"."id" > 2
) AS "x"
JOIN (
  SELECT
    "y"."id" AS "id",
    "y"."name" AS "name"
  FROM "y" AS "y"
) AS "y"
  ON "x"."id" = "y"."id"
```

–°—Ç–æ–∏—Ç –æ—Ç–º–µ—Ç–∏—Ç—å, —á—Ç–æ —Å –ø–æ–º–æ—â—å—é —Ñ–ª–∞–≥–∞ `-o` –≤—ã –º–æ–∂–µ—Ç–µ —É–∫–∞–∑–∞—Ç—å –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ –∫–∞–∫–∏–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –≤–∞–º —Ç—Ä–µ–±—É—é—Ç—Å—è.

### Anti_pattern
---
–° –ø–æ–º–æ—â—å—é `sqlcheck` –º—ã –ø—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞—à–∏ –∑–∞–ø—Ä–æ—Å—ã –Ω–∞ –Ω–∞–ª–∏—á–∏–µ –≤ –Ω–∏—Ö –∞–Ω—Ç–∏–ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤. –ú–æ–¥—É–ª—å –æ—Å–æ–±–µ–Ω–Ω–æ –ø–æ–ª–µ–∑–µ–Ω, –ø–æ—Å–∫–æ–ª—å–∫—É –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –ø–æ–¥—Ä–æ–±–Ω–æ–µ –æ–±—ä—è—Å–Ω–µ–Ω–∏–µ, –ø–æ—á–µ–º—É —Ç–æ –∏–ª–∏ –∏–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ - –ø–ª–æ—Ö–æ–µ, –∏ –ø—Ä–µ–¥–ª–∞–≥–∞–µ—Ç –º–µ—Ç–æ–¥—ã –µ–≥–æ —Ä–µ—à–µ–Ω–∏—è.
–ê–∫—Ç—É–∞–ª—å–Ω—ã–π —Å–ø–∏—Å–æ–∫ –≤—ã—è–≤–ª—è–µ–º—ã—Ö –∞–Ω—Ç–∏–ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω [–∑–¥–µ—Å—å](https://github.com/jarulraj/sqlcheck#what-it-can-do)

```Bash
# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –æ—Ç–¥–µ–ª—å–Ω–æ–≥–æ –º–æ–¥—É–ª—è - Anti_Pattern
!python -m swissql anti_pattern -q "SELECT * from x join y on x.id = y.id where x.id > 2"

[33m[Detecting anti-patterns using sqlcheck][0m
sqlcheck version 1.2.1
Debug build (NDEBUG not #defined)
+-------------------------------------------------+
|                   SQLCHECK                      |
+-------------------------------------------------+
> RISK LEVEL    :: ALL ANTI-PATTERNS
> SQL FILE NAME :: temp.sql
> COLOR MODE    :: ENABLED
> VERBOSE MODE  :: ENABLED
> DELIMITER     :: ;
-------------------------------------------------
==================== Results ===================

-------------------------------------------------
SQL Statement at line 1: [1m[31mselect * from x join y on x.id = y.id where x.id > 2;[0m[39m
[temp.sql]: ([1m[32mHIGH RISK[0m[39m) [1m[34mSELECT *[0m[39m
‚óè Inefficiency in moving data to the consumer:
When you SELECT *, you're often retrieving more columns from the database than
your application really needs to function. This causes more data to move from
the database server to the client, slowing access and increasing load on your
machines, as well as taking more time to travel across the network. This is
especially true when someone adds new columns to underlying tables that didn't
exist and weren't needed when the original consumers coded their data access.


‚óè Indexing issues:
Consider a scenario where you want to tune a query to a high level of
performance. If you were to use *, and it returned more columns than you
actually needed, the server would often have to perform more expensive methods
to retrieve your data than it otherwise might. For example, you wouldn't be able
to create an index which simply covered the columns in your SELECT list, and
even if you did (including all columns [shudder]), the next guy who came around
and added a column to the underlying table would cause the optimizer to ignore
your optimized covering index, and you'd likely find that the performance of
your query would drop substantially for no readily apparent reason.

‚óè Binding
Problems:
When you SELECT *, it's possible to retrieve two columns of the same name from
two different tables. This can often crash your data consumer. Imagine a query
that joins two tables, both of which contain a column called "ID". How would a
consumer know which was which? SELECT * can also confuse views (at least in some
versions SQL Server) when underlying table structures change -- the view is not
rebuilt, and the data which comes back can be nonsense. And the worst part of it
is that you can take care to name your columns whatever you want, but the next
guy who comes along might have no way of knowing that he has to worry about
adding a column which will collide with your already-developed names.
[Matching Expression: [1m[34mselect *[0m[39m at line 1]


==================== Summary ===================
All Anti-Patterns and Hints  :: 1
>  High Risk   :: 1
>  Medium Risk :: 0
>  Low Risk    :: 0
>  Hints       :: 0

```

### Rule
---
–ü–æ–¥–¥–µ—Ä–∂–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö –ø—Ä–∞–≤–∏–ª –æ—Å—É—â–µ—Å—Ç–≤–ª—è–µ—Ç—Å—è —Å –ø–æ–º–æ—â—å—é `Lark` –∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º —Ñ–∞–π–ª–æ–≤ —Å –ø—Ä–æ–ø–∏—Å–∞–Ω–Ω–æ–π BNF –≥—Ä–∞–º–º–∞—Ç–∏–∫–æ–π –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ–≥–æ –ø–∞—Ç—Ç–µ—Ä–Ω–∞. –ü—Ä–∏–º–µ—Ä –≥—Ä–∞–º–º–∞—Ç–∏–∫–∏ –∏ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏—è –ø–∞—Ç—Ç–µ—Ä–Ω–∞ - –Ω–∏–∂–µ

```Bash
# –ö–∞–∫ –≤—ã–≥–ª—è–¥–∏—Ç —Ñ–∞–π–ª —Å BNF –≥—Ä–∞–º–º–∞—Ç–∏–∫–æ–π
!cat rules/filter2.lark

SELECT WILDCARD ANTIPATTERN :END_OF_COMMENT:
start: /./ start | pattern start | /./ | pattern
pattern: "SELECT *"i
%import common.INT
//%ignore " "
%ignore "\n"
```

–û–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–≥–æ –ø—Ä–∞–≤–∏–ª–∞:
```Bash
# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –æ—Ç–¥–µ–ª—å–Ω–æ–≥–æ –º–æ–¥—É–ª—è - Rules
!python -m swissql rule -r filter2.lark -q "SELECT * from x join y on x.id = y.id where x.id > 2"

[Finding rules using lark]
Rule filter2.lark found:
Positions: (1, 1)
Comment: SELECT WILDCARD ANTIPATTERN 
```

### Extract
---
Extract - –º–æ–¥—É–ª—å, –Ω–∞ –æ—Å–Ω–æ–≤–µ —Ä–µ–≥—É–ª—è—Ä–Ω—ã—Ö –≤—ã—Ä–∞–∂–µ–Ω–∏–π –¥–ª—è –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏—è —Å—Ç—Ä–æ–∫ –∏ –∏—Ö –ø–∞—Ä—Å–∏–Ω–≥–∞ —Å –ø–æ–º–æ—â—å—é `Lark` –¥–ª—è –æ—Ç—Å–µ–∏–≤–∞–Ω–∏—è –Ω–µ SQL-–∑–∞–ø—Ä–æ—Å–æ–≤. –ü–æ–∑–≤–æ–ª—è–µ—Ç –∏–∑–≤–ª–µ—á—å –∏–∑ –∫–æ–¥–æ–≤–æ–π –±–∞–∑—ã SQL-–∑–∞–ø—Ä–æ—Å—ã –¥–ª—è –¥–∞–ª—å–Ω–µ–π—à–µ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∏ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞. –ü—Ä–∏–º–µ—Ä —Ä–∞–±–æ—Ç—ã:
```Python
# –ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ–º—ã–π –∫—É—Å–æ–∫ –∫–æ–¥–∞
from pyspark.sql import SparkSession
from pyspark.sql.types import StructType, StructField, IntegerType
from datetime import datetime, date
from pyspark.sql import Row

def init_spark():
    spark = SparkSession.builder.appName("HelloWorld").getOrCreate()
    sc = spark.sparkContext
    return spark, sc


# SQl Queries
sql_queries = [
    'SELECT * FROM table1;',
    'SELECT * FROM table1 WHERE id = 1;',
    'SELECT * FROM table1 WHERE id = 1 AND name = "John" OR name = "Jane" OR name = "Jack";',
]

def main():
    spark_sql_queries = [
        "SELECT * FROM table",
    ]
...

if __name__ == "__main__":
    main()
```
–†–µ–∑—É–ª—å—Ç–∞—Ç:
```Bash
# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –æ—Ç–¥–µ–ª—å–Ω–æ–≥–æ –º–æ–¥—É–ª—è - Swissql extractor
!python -m swissql extract -f examples/example3.py
[Extracting Spark SQLs from file using lark]
Found:
SELECT * FROM table1
SELECT * FROM table1 WHERE id = 1
SELECT * FROM table1 WHERE id = 1 AND name = "John" OR name = "Jane" OR name = "Jack"
SELECT * FROM table
select * from tableA
```

### Query_Planning
---
–ü–ª–∞–Ω—ã –∑–∞–ø—Ä–æ—Å–æ–≤ TODO: <...> –î–æ–ø–∏—Å–∞—Ç—å


## –°—Ç–µ–∫
- [argparse](https://docs.python.org/3/library/argparse.html#module-argparse) - –ü–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ CLI 
- [sqlglot](https://github.com/tobymao/sqlglot) - –°–∏–Ω—Ç–∞–∫—Å–∏—á–µ—Å–∫–∏–π —Ä–∞–∑–±–æ—Ä SparkSQL, –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –∏ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
- [sqlfluff](https://github.com/sqlfluff/sqlfluff) - –°—Ç–∏–ª–∏—Å—Ç–∏—á–µ—Å–∫–∏–π –∞–Ω–∞–ª–∏–∑ SparkSQL, —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ —Å—Ç–∏–ª—é –∏ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
- [sqlcheck](https://github.com/jarulraj/sqlcheck) - –î–µ—Ç–µ–∫—Ü–∏—è –∞–Ω—Ç–∏-–ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤ –≤ –∑–∞–ø—Ä–æ—Å–∞—Ö SparkSQL. –†–µ–∫–æ–º–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ —É–ª—É—á—à–µ–Ω–∏—é –∫–æ–¥–∞.
- [Lark](https://github.com/lark-parser/lark) - –ü–∞—Ä—Å–∏–Ω–≥ –Ω–∞ –æ—Å–Ω–æ–≤–µ BNF –≥—Ä–∞–º–º–∞—Ç–∏–∫–∏. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç—Ä–æ–∫ –Ω–∞ –Ω–∞–ª–∏—á–∏–µ SQL –∑–∞–ø—Ä–æ—Å–∞, –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ –ø—Ä–∞–≤–∏–ª–∞.


## –ê–≤—Ç–æ—Ä—ã
### ***I PRO*** - —ç—Ç–æ –º—ã!
- –ï–≥–æ—Ä –ì–æ–ª—É–±–µ–≤ - _–±–µ–∫–µ–Ω–¥-—Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫_
- –ê–Ω–¥—Ä–µ–π –ë–∞—Ä–∞–Ω–æ–≤ - _–±–µ–∫–µ–Ω–¥-—Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫_
- –ï–≥–æ—Ä –°–º—É—Ä—ã–≥–∏–Ω - _–ø—Ä–æ–¥—É–∫—Ç-–º–µ–Ω–µ–¥–∂–µ—Ä_
- –õ–µ–±–µ–¥–µ–≤–∞ –¢–∞—Ç—å—è–Ω–∞ - _–±–µ–∫–µ–Ω–¥-—Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫_
- –¢–∞–º–ø–∏–æ –ò–ª—å—è - _–±–µ–∫–µ–Ω–¥-—Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫_
