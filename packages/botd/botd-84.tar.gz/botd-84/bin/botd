#!/usr/bin/env python3
# This file is placed in the Public Domain.


"BOTD - 24/7 channel daemon"


import os
import signal
import sys
import termios
import time


import op.all


op.obj.workdir = "/var/lib/botd"


from op.run import Config


Config.channel = "#botd"
Config.name = "botd"
Config.version = "83"
Config.workdir = "/var/lib/botd/"


from op.bus import Bus
from op.run import Commands, dispatch
from op.hdl import Callbacks, Handler
from op.obj import format, keys
from op.run import CLI, Console, Table
from op.utl import cdir


from bot import irc, rss


Table.add(irc)
Table.add(rss)


allmod =  ",".join(keys(Table.mod))


def daemon():
    pid = os.fork()
    if pid != 0:
        os._exit(0)
    os.setsid()
    os.umask(0)
    si = open("/dev/null", 'r')
    so = open("/dev/null", 'a+')
    se = open("/dev/null", 'a+')
    os.dup2(si.fileno(), sys.stdin.fileno())
    os.dup2(so.fileno(), sys.stdout.fileno())
    os.dup2(se.fileno(), sys.stderr.fileno())


def signal_HUP(sig, frame):
    print("signal 15 called")
    sys.stdout.flush()


#signal.signal(signal.SIGHUP, signal_HUP)


def main():
    #daemon()
    i = irc.IRC()
    i.start()
    f = rss.Fetcher()
    f.start()
    while 1:
        time.sleep(1.0)


main()
